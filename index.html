<html>
<head>
    <title>JSON化によるLISPの実装</title>
    <link rel="stylesheet" type="text/css" href="styles.css">
    <meta charset="UTF-8">
</head>
<body>
    <h1>LISP広場</h1>
    <p>一通りの機能を実装しましたが、何か不具合がございましたらお知らせください。</p>
    <textarea id ="input" rows="20" cols="40"></textarea>
    <input type="button" value="Run" onclick="document.getElementById('output').value = ''; runLisp(document.getElementById('input').value)"/>
    <br>
    <textarea id ="output" rows="20" cols="40"></textarea>
    <canvas id="canvas1" width="512" height="512"></canvas>
    <script src="JSLisp.js"></script>
    <script>
        onload = function() {
            document.getElementById('input').value = `
(cout output "変数定義と出力")
(def x -10.51) 
(def y 9.8) 
(cout output x)
(cout output y)

(cout output "論理演算")
(cout output (and 1 0))
(cout output (or 1 0))

(cout output "関数定義と呼び出し")
(func add (a b) 
    (+ a b)
)
(cout output (add 10 20))
(cout output "１～ｎまでの和")
(func sum (n)
  (def s 0)
  (def i 1)
  (while (< i (+ n 1))
    (set s (+ s i))
    (set i (+ i 1)))
  (return s))
(cout output (sum 100))
(cout output "１～ｎまでの和（公式）")
(func sum2 (n)
  (return (/ (* n (+ n 1)) 2)))
(cout output (sum2 100))

(cout output "a b 比較して小さいほう判定")
(func min(a b)
  (if (< a b)
    (return a)
    (return b)))
(cout output (min 10 20))
(cout output (min 30 20))
(cout output (min x 50))
(cout output "変数スコープ")
(def a 0)
(set a (min 10 20))
(cout output a)

(cout output "再帰ルーチン(フィボナッチ)")
(func rec(a b n)
  (if (> n 0)
    (
      (cout output a)
      (set b  (+ a b))
      (set a  (- b a))
      (set n  (- n 1))
      (rec a b n)
    )
  )
)

(rec 0 1 15)

(cout output "リスト操作")
(def mylist '(1 2 3 4)) 
(cout output (car mylist))
(cout output (cdr mylist))
(cout output (cons 0 mylist))
(cout output (length mylist))
(cout output (append mylist '(5 6)))

(def TOWNS '(LONDON READING OXFORD))
(cout output (car TOWNS))
(cout output (cdr TOWNS))

(def alpha '(((A B)C)D))

(cout output (car alpha))
(cout output (car (car alpha)))
(cout output (cdr alpha))
(set a (cdr alpha))
(cout output (car a))
(cout output "nilの扱い")
(cout output (append '(AB) nil))
(cout output "reverseのテスト")
(cout output (reverse '(1 2 3)))
(cout output "Canvasへの描画")
(fillRect canvas1 0 0 512 512 "#AAAAAA")

(cout output "マンデルブロ集合の描画")
(cout output "Mandelbrot start")

(def width 512)
(def height 512)
(def maxIter 50)

(def x 0)
(def y 0)

(def cx 0)
(def cy 0)
(def zx 0)
(def zy 0)
(def tx 0)
(def ty 0)
(def iter 0)

(while (< y height)
  (set x 0)
  (while (< x width)

    (set cx (+ -2 (* 3 (/ x width))))
    (set cy (+ -1.5 (* 3 (/ y height))))

    (set zx 0)
    (set zy 0)
    (set iter 0)

    (while (and (< (+ (* zx zx) (* zy zy)) 4)
                (< iter maxIter))

      (set tx (- (* zx zx) (* zy zy)))
      (set ty (+ (* 2 zx zy) cy))
      (set zx (+ tx cx))
      (set zy ty)

      (set iter (+ iter 1))
    )

    (if (< iter maxIter)
        (switch (% iter 8)
          (case 0 (fillRect canvas1 x y 1 1 "#F00"))
          (case 1 (fillRect canvas1 x y 1 1 "#FF0"))
          (case 2 (fillRect canvas1 x y 1 1 "#0F0"))
          (case 3 (fillRect canvas1 x y 1 1 "#0FF"))
          (case 4 (fillRect canvas1 x y 1 1 "#00F"))
          (case 5 (fillRect canvas1 x y 1 1 "#F0F"))
          (case 6 (fillRect canvas1 x y 1 1 "#F80"))
          (default (fillRect canvas1 x y 1 1 "#FFF"))
        )
        (fillRect canvas1 x y 1 1 "#000"))

    (set x (+ x 1))
  )
  (set y (+ y 1))
)

(cout output "Mandelbrot end")

(cout output "switch文のテスト")
(set a 'A)
(switch a
  (case A (cout output 1))
  (case B (cout output 2))
  (default (cout output 1))
)



`;
        };
    </script>
</body>

</html>